<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Guerrilla GIS v1</title>
  </head>

  <script id="accountChooserTemplate" type="text/template">
    <div class="col-md-6 col-md-offset-3">
      <div class="row">
        <div id="logo" class="text-center">
        <h1>GuerrillaGIS v1</h1><p>Avoid censorship using the blockchain</p>
        </div>
        <form role="form" class="accountForm" onSubmit="return false;">
          <div class="form-group">
            <div class="input-group">
              <input id="1" class="form-control accountInput" type="text" name="account" placeholder="Project name id" required/>
              <span class="input-group-btn">
              <button class="btn btn-success" type="submit">
              <i class="glyphicon glyphicon glyphicon-chevron-right" aria-hidden="true"></i>
              </button>
              </span>
            </div>
          </div>
        </form>
      </div>
    </div>
  </script>

  <script id="mapTemplate" type="text/template">
    <div id="mapContainer" style="width:100%;height:600px;">
    </div>
  </script>

  <script id="accountFormTemplate"  type="text/template">

    <% if( newAccount == true  ) { %>
    <div class="panel panel-info">
      <div class="panel-heading">Create new account </div>
      <div class="panel-body">Panel Content</div>
    </div>
    <% } %>

    <form id="signupForm" method="post" class="form-horizontal"  onSubmit="return false;">

      <div class="form-group"  <% if( newAccount == false  ) { %> style="display:none;" <%}%>>
        <div class="col-sm-5">
          <input type="text" class="form-control" id="accountIdName" name="accountIdName" placeholder="Account name (without spaces)" value="<%- accountIdName %>"/>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-5">
          <textarea class="form-control" id="accountDesc" name="accountDesc" placeholder="Map description, contact info, etc..." ><%- desc %></textarea>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-5 col-sm-offset-4">
          <div class="checkbox">
          <label>
            <input type="checkbox" id="clusterize" name="clusterize" value="clusterize"  <% if( clusterize == true ){%> checked <%}%> />Clusterize markers
          </label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-5">
          <input type="text" class="form-control" id="accountLat" name="accountLat" placeholder="Latitude"  value="<%-lat%>" />
          <input type="text"  class="form-control" id="accountLng" name="accountLng" placeholder="Longitude"  value="<%-lng%>" />
          <input type="text"  class="form-control" id="accountZoom" name="accountZoom" placeholder="Zoom" value="<%-zoom%>"/>
        </div>
      </div>
      <div id="accountMap" style="width:400px;height:400px;"></div>
      <div class="form-group">
        <div class="col-sm-5 col-sm-offset-4">
          <div class="checkbox">
          <label>
            <input type="checkbox" id="agree" name="agree" value="agree"/>I Understand
          </label>
          </div>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-9 col-sm-offset-4">
          <button type="submit" class="btn btn-primary" name="signup" value="Sign up"><% if( newAccount == true  ) {%>Create Account<%}else{%>Save<%}%></button>
        </div>
      </div>
    </form>

  </script>

  <script id="locationFormTemplate"  type="text/template">
    Formulario de sitio
  </script>

  <script id="locationsListTemplate"  type="text/template">
    Lista de sitios
  </script>

  <body>
    <div class="header"></div>
    <div class="content"></div>
  </body>

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href='vendor/bootstrap/dist/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
  <link href='vendor/leaflet/dist/leaflet.css' rel='stylesheet' type='text/css'>
  <script src="vendor/web3/dist/web3.min.js"></script>
  <script src="vendor/jquery/dist/jquery.min.js"></script>
  <script src="vendor/jquery-validation/dist/jquery.validate.min.js"></script>
  <script src="vendor/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="vendor/underscore/underscore-min.js"></script>
  <script src="vendor/backbone/backbone-min.js"></script>
  <script src="vendor/leaflet/dist/leaflet.js"></script>



  <script src="js/conf.js"></script>
  <script src="js/contract.js"></script>

  <script src="js/model/AccountModel.js"></script>

  <script src="js/view/AccountChooserView.js"></script>
  <script src="js/view/AccountFormView.js"></script>
  <script src="js/view/LocationFormView.js"></script>
  <script src="js/view/LocationsListView.js"></script>
  <script src="js/view/MapView.js"></script>

  <script src="js/router/appRouter.js"></script>



  <script src="vendorStatic/ethereumjs-tx-1.3.3.min.js"></script>




  <script src="js/app.js"></script>
  <!--script src="js/test.js"></script-->
  <script>
/*
function crea(){
    var conta = new AccountModel({
      accountIdName: 'lal',
      desc: 'lal conta lal',
      clusterize: false,
      lat: 40.737,
      lng: -73.923,
      zoom: 10,
    });
    conta.saveOnContract(200000);
}*/


function enviar(){
    var senderAddr = '0xc655c4812584BF855d53584e553c22C8D714D9ca';
    var data = contract.contractInstance.setAccount.getData( 'renova', 'ooooooooooo', true, 1,1,1 ,  { from:senderAddr, gas:20000} );
    var gasPrice = 0.8; //var gasPrice = web3.eth.gasPrice;
    var gasLimit = 3000000;

    web3.eth.getTransactionCount(senderAddr, function(error, result) {
           var nonce = result;

           var rawTransaction = {
             "from": senderAddr,
             "nonce": web3.toHex( nonce ),
             "gasPrice": web3.toHex(gasPrice ^1000000000),
             "gasLimit": web3.toHex(gasLimit),
             "to": conf.contractAddress,
             "value": "0x00",
             "data": data,
             "chainId": 3 //change the chainID accordingly
           };

           var privKey = new ethereumjs.Buffer.Buffer( '15d7f910f479c3e2f0d2eee48a71ab4f017cc786ca31122f37b3518f44b27bfb' , 'hex');
           var tx = new ethereumjs.Tx(rawTransaction);

           tx.sign(privKey);
           var serializedTx = tx.serialize();
           web3.eth.sendRawTransaction('0x' + serializedTx.toString('hex'), function(err, hash) {
           if (!err)
               {
                 console.log('Txn Sent and hash is '+hash);
               }
           else
               {
                 console.error(err);
               }
           });
    });





    //var privKey = new Buffer( '15d7f910f479c3e2f0d2eee48a71ab4f017cc786ca31122f37b3518f44b27bfb' , 'hex');
    //var tx = new Tx(rawTransaction);
/*
    tx.sign(privKey);
    var serializedTx = tx.serialize();*/
/*
    web3.eth.sendRawTransaction('0x' + serializedTx.toString('hex'), function(err, hash) {
    if (!err)
        {
          console.log('Txn Sent and hash is '+hash);
        }
    else
        {
          console.error(err);
        }
    });*/
}


  </script>
</html>
